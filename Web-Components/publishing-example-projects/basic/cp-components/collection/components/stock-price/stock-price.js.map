{"version":3,"file":"stock-price.js","sourceRoot":"","sources":["../../../src/components/stock-price/stock-price.tsx"],"names":[],"mappings":"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","sourcesContent":["import { Component, Host, h, State, Prop, Watch, Listen } from '@stencil/core';\n\nimport { AV_API_KEY } from '../../global/global';\n\n@Component({\n  tag: 'cp-stock-price',\n  styleUrl: 'stock-price.css',\n  shadow: true,\n})\nexport class StockPrice {\n  //Referencing an element\n  stockInput: HTMLInputElement;\n\n  // @Element() el: HTMLElement; //To access host element\n\n  @State() validStockInput = false;\n  @State() fetchedPrice: number;\n  @State() error: string;\n  @State() loading = false;\n\n  @Prop({ mutable: true, reflect: true }) stockUserInput: string;\n\n  //All lifecycles\n  componentWillLoad() {\n    //will run right before component is about to load.\n    console.log('componentWillLoad');\n  }\n\n  componentDidLoad() {\n    console.log('componentDidLoad');\n    if (this.stockUserInput) {\n      this.validStockInput = true;\n      this.fetchStockPrice(this.stockUserInput);\n    }\n  }\n\n  componentWillUpdate() {\n    //runs right before rerendering the component after any property change\n    console.log('componentWillUpdate');\n  }\n  componentDidUpdate() {\n    //runs after component rerendered\n    console.log('componentDidUpdate');\n    //handled by watchToChanges\n    // if(this.stockSymbol !== this.stockUserInput) {  //used to run when prop is updated from outside\n    //   this.stockUserInput = this.stockSymbol;\n    //   this.fetchStockPrice(this.stockSymbol);\n    // }\n  }\n\n  //listening to event emitted by other components\n  @Listen('symbolEmitter', { target: 'body' })\n  onStockSymbolSelected(event: CustomEvent) {\n    if (event.detail && event.detail !== this.stockUserInput) {\n      this.stockUserInput = event.detail;\n      // this.fetchStockPrice(event.detail);\n    }\n  }\n\n  //keep watching on this attribute\n  @Watch('stockUserInput')\n  stockSymbolChanged(newValue: string, oldValue: string) {\n    if (newValue !== oldValue) {\n      this.stockUserInput = newValue;\n      this.validStockInput = true;\n      this.fetchStockPrice(newValue);\n    }\n  }\n\n  disconnectedCallback() {\n    // after component is unloaded from the DOM\n    console.log('disconnectedCallback');\n  }\n\n  // //hostData returns some metaData about the component.\n  // hostData() {\n  //   return {class: this.error ? 'error' : ''}; //this will add error class in tag of the component\n  // } // <Host> should not be used for this\n\n  private onUserInput(event: Event) {\n    this.stockUserInput = (event.target as HTMLInputElement).value;\n    this.validStockInput = this.stockUserInput.trim() !== '' ? true : false; //can be used for check brfore fetching from API\n  }\n\n  private onFetchStockPrice(event: Event) {\n    event.preventDefault();\n    //accessing value of input\n    // console.log(this.el.shadowRoot.querySelector('#stock-symbol'));\n    // const stockSymbol = (this.el.shadowRoot.querySelector('#stock-symbol') as HTMLInputElement).value;\n\n    //refrenced element\n    // console.log(this.stockInput);\n    // const stockSymbol = this.stockInput.value;\n    // fetch(`https://www.alphavantage.co/query?function=GLOBAL_QUOTE&symbol=${stockSymbol}&apikey=${AV_API_KEY}`)\n    this.fetchStockPrice(this.stockUserInput);\n  }\n\n  private fetchStockPrice(stockUserInput: string) {\n    this.loading = true;\n    this.error = null;\n    this.fetchedPrice = undefined;\n    fetch(`https://www.alphavantage.co/query?function=GLOBAL_QUOTE&symbol=${stockUserInput}&apikey=${AV_API_KEY}`)\n      .then(res => {\n        if (res.status !== 200) {\n          throw new Error('Invalid');\n        }\n        return res.json();\n      })\n      .then(parsedRes => {\n        if (!parsedRes['Global Quote'] || !parsedRes['Global Quote']['05. price']) {\n          throw new Error('Invalid symbol!');\n        }\n        this.error = null;\n        this.fetchedPrice = +parsedRes['Global Quote']['05. price'];\n        this.loading = false;\n      })\n      .catch(err => {\n        this.error = err.message;\n        this.fetchedPrice = null;\n        this.loading = false;\n      });\n  }\n  render() {\n    return (\n      <Host class={this.error ? 'error' : ''}>\n        <form class=\"form-container\" onSubmit={this.onFetchStockPrice.bind(this)}>\n          <input id=\"stock-symbol\" ref={el => (this.stockInput = el)} value={this.stockUserInput} onInput={this.onUserInput.bind(this)} /> {/* Referencing the element */}\n          {/* Setting up two way binding for stockUserInput variable */}\n          {/* updating stockUserInput variable on every key stroke */}\n          <button type=\"submit\" class=\"search-button\" disabled={!this.validStockInput || this.loading}>\n            Fetch\n          </button>\n        </form>\n        <div>\n          {this.loading ? (\n            <cp-spinner></cp-spinner>\n          ) : (\n            <span>{this.error ? <p>{this.error}</p> : <p>Price: {this.fetchedPrice && '$' + this.fetchedPrice}</p>}</span>\n          )}\n        </div>\n      </Host>\n    );\n  }\n}\n"]}